<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>FIBA 3x3 Rules — Full Quiz (All Items, Instant Feedback)</title>
<style>
  :root{
    --bg:#0e1117; --card:#141925; --ink:#e8edf2; --muted:#9aa3ad; --accent:#3874ff; --good:#10b981; --bad:#ef4444;
  }
  html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,#0d1117,#0b0e14);color:var(--ink);font:16px/1.55 system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1100px;margin:0 auto;padding:24px}
  h1{font-weight:800;font-size:clamp(20px,2.2vw,28px);letter-spacing:.2px;margin:.2rem 0 1rem}
  .card{background:var(--card);border:1px solid rgba(255,255,255,.08);box-shadow:0 10px 30px rgba(0,0,0,.25);border-radius:16px;overflow:hidden}
  .bar{height:6px;background:#2a2f3a}
  .bar>i{display:block;height:100%;width:0;background:linear-gradient(90deg,#3874ff,#5aa3ff,#88b4ff);transition:width .4s ease}
  .q-body{padding:18px 20px 6px 20px}
  .q-meta{display:flex;justify-content:space-between;color:var(--muted);font-size:.92rem;margin-bottom:8px}
  .q-text{font-size:1.12rem;margin:6px 0 12px 0}
  .q-img{display:block;max-width:340px;max-height:340px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:#0c0f15;margin:8px 0}
  .opts{display:grid;gap:10px;padding:0 20px 12px}
  .opt{display:flex;gap:10px;align-items:flex-start;background:#10141d;border:1px solid rgba(255,255,255,.09);padding:12px 12px;border-radius:12px;cursor:pointer;transition:.18s}
  .opt input{margin-top:2px}
  .opt:hover{transform:translateY(-1px);border-color:#3a4050}
  .opt.correct{border-color:rgba(16,185,129,.8);color:var(--good)}
  .opt.wrong{border-color:rgba(239,68,68,.8);color:var(--bad)}
  .footer{display:flex;gap:10px;align-items:center;padding:14px 16px;background:#121722;border-top:1px solid rgba(255,255,255,.08)}
  button{border:0;border-radius:12px;padding:11px 16px;font-weight:700;cursor:pointer}
  .ghost{color:var(--ink);background:#1a2130;border:1px solid rgba(255,255,255,.1)}
  .next{background:var(--accent);color:#fff}
  .submit{background:#0ea5e9;color:#fff}
  .hidden{display:none !important}
  .pill{display:inline-flex;align-items:center;gap:8px;background:#18202d;border:1px solid #233047;color:#bcd0ea;border-radius:100px;padding:.2rem .6rem;font-size:.8rem}
  .feedback{padding:6px 20px 14px;color:var(--muted)}
  .result{padding:22px}
  .score{font-size:1.6rem;font-weight:800;margin:0 0 10px 0}
  .answersheet{padding:10px 14px 24px}
  .answer-row{display:grid;grid-template-columns:48px 1fr;gap:12px;background:#0f1420;border:1px solid rgba(255,255,255,.08);border-radius:12px;margin:10px 0;padding:12px}
  .answer-row img{max-height:140px;border-radius:8px;border:1px solid rgba(255,255,255,.08)}
  .good{color:var(--good)} .bad{color:var(--bad)} .muted{color:var(--muted)} .small{font-size:.85rem}
</style>
</head>
<body>
<div class="wrap">
  <h1>FIBA 3x3 Rules — Interactive MCQ Practice</h1>

  <div class="card" id="quiz">
    <div class="bar"><i id="progress"></i></div>
    <div class="q-body">
      <div class="q-meta">
        <div id="qcount" class="pill">Question 1</div>
        <div class="pill"><span id="category">General</span></div>
      </div>
      <div id="qtext" class="q-text">Loading…</div>
      <img id="qimg" class="q-img hidden" alt="Referee signal"/>
    </div>
    <div id="options" class="opts"></div>
    <div id="feedback" class="feedback"></div>
    <div class="footer">
      <button id="back" class="ghost" title="Go to previous question">Back</button>
      <button id="next" class="next">Next</button>
      <button id="submit" class="submit hidden">Finish & Summary</button>
      <div style="margin-left:auto" class="muted small">Answers show immediately; progress is saved.</div>
    </div>
  </div>

  <div id="results" class="card hidden">
    <div class="result">
      <p class="score" id="scoreline">Score: —</p>
      <p class="muted">Summary of all questions and correct answers:</p>
      <div class="answersheet" id="answerKey"></div>
    </div>
  </div>
</div>

<script>
/* ============================================================
   Helpers
   ============================================================ */
const shuffle = a => { for (let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a; };
const uniqBy = (arr, keyFn) => {
  const out=[]; const seen=new Set();
  for(const x of arr){ const k=keyFn(x); if(!seen.has(k)){seen.add(k); out.push(x);} }
  return out;
};

/* ============================================================
   Referee SIGNALS — image items (answers are exact file names)
   ============================================================ */
const signalFiles = [
  "1. Stop the clock.jpeg","2. Stop the clock for foul.jpeg","3. 1 Point.jpeg","4. 2 points.jpeg",
  "5. Charged time-out.jpeg","6. TV time-out.jpeg","7. Cancel score, cancel play.jpeg","8. Visible count.jpeg",
  "9. Communication.jpeg","10. Shot clock reset.jpeg","11. Out-of-bounds.jpeg","12. Held ball:jump ball situation.jpeg",
  "13. Travelling.jpeg","14. Illegal Dribble_Double dribbling.jpeg","15. Illegal dribble_Carrying the ball.jpeg",
  "16. 3 seconds.jpeg","17. 5 seconds.jpeg","18. 12 seconds.jpeg","19. Deliberate kick or block of the ball.jpeg",
  "20. Ball not cleared.jpeg","31. Holding.jpeg","32. Blocking (defense)_Illegal screen (offense).jpeg",
  "33. Pushing or charging without the ball.jpeg","34. Handchecking.jpeg","35. Illegal use of hands.jpeg",
  "36. Charging with the ball.jpeg","37. Illegal contact to the hand.jpeg","38. Hooking.jpeg",
  "39. Excessive swinging of the elbow.jpeg","40. Hit to the head.jpeg","41. Foul by team in control of the ball.jpeg",
  "42. Foul on the act of shooting.jpeg","43. Foul not on the act of shooting.jpeg","44. Double foul.jpeg",
  "45. Technical foul.jpeg","46. Unsportsmanlike foul.jpeg","47. Disqualifying foul.jpeg",
  "48. Fake a foul.jpeg","49. IRS review.jpeg","50. Challenge.jpeg",
  "51. After foul without free throw(s).jpeg","52. After foul by team in control of the ball.jpeg",
  "53. 1 free throw.jpeg","54. 2 free throws.jpeg","55. 1 free throw.jpeg","56. 2 free throws.jpeg"
];
const labelFromFile = f => f.replace(/^\s*\d+\.\s*/,'').replace(/\.(jpeg|jpg|png)$/i,'');
function buildSignalQuestions(){
  const labels = signalFiles.map(labelFromFile);
  return signalFiles.map((file, idx) => {
    const correct = labels[idx];
    const wrongs = shuffle(labels.filter((_,i)=>i!==idx)).slice(0,3);
    const options = shuffle([correct, ...wrongs]);
    return {
      id:`SIG::${file}`, type:"image", cat:"Referee signals",
      q:"What does this referee signal indicate?",
      img: file, options,
      answer: options.indexOf(correct),
      rationale: `Correct signal: “${correct}”.`
    };
  });
}

/* ============================================================
   TEXT FACTS — exact sentences from your rules (verbatim)
   NOTE: You can add more lines freely; each becomes an MCQ.
   ============================================================ */
const FACT_SENTENCES = [
  // PLAYING COURT & EQUIPMENT — Playing court & lines
  "A regular 3x3 playing court shall have a flat, hard surface free from obstructions with dimensions of 15 m in width and 11 m in length measured from the inner edge of the boundary line.",
  "The court shall have a regular basketball playing court sized zone, including a free throw line (5.80 m), a 2-point line (6.75 m) and a \"no-charge semi-circle\" area underneath the basket.",
  "The playing area shall be marked in 3 colours: restricted area and 2-point area in one colour, the remaining playing area in another colour and the out-of-bound area in black.",
  "The colours in Diagram 1 shall be mandatory for the following competitions: FIBA 3x3 World Cups, FIBA 3x3 Champions Cup, Olympic Games, FIBA 3x3 World Tour, FIBA 3x3 Zone Cups.",
  "At grassroots level, 3x3 can be played anywhere; court markings shall be adapted to available space.",
  "FIBA 3x3 Official Competitions must fully comply with the above specifications including backstop with the shot clock integrated in the backstop padding.",
  "All lines shall be of the same colour and drawn in white or other contrasting colour, 5 cm in width and clearly visible.",
  "The playing court shall be limited by the boundary line, consisting of the baseline, endline and the sidelines.",
  "These lines are not part of the playing court.",
  "There shall be an additional boundary area of 1 m at the endline, 1.5 m at the sidelines and 2 m at the baseline around the playing court.",
  "The scorer's table and its chairs must be placed behind the endline on the left-hand side when facing the basket.",
  "Exceptionally in Pro Circuit events the scorer's table may cut the corner at the endline.",
  "To the side of the scorer's table there shall be 2 seats available for the substitutes.",
  // Free-throw line & restricted area
  "The free-throw line shall be drawn parallel to the baseline and endline.",
  "Its furthest edge shall be 5.80 m from the inner edge of the baseline and shall be 3.60 m long.",
  "Its mid-point shall lie on the imaginary line joining the mid-point of the endline and baseline.",
  "The restricted area shall be the rectangular area limited by the baseline, the extended free-throw line and the lines 2.45 m from the mid-point of the baseline.",
  "These lines, excluding the baseline, are part of the restricted area.",
  "Free-throw rebound places shall be marked as in Diagram 2.",
  // 2-point field goal area
  "The teams' 2-point field goal area shall be the entire floor area of the playing court, except for the area inside the arc.",
  "The arc has a radius of 6.75 m measured from the point on the floor beneath the exact centre of the basket to the outer edge of the arc.",
  "The distance of that point on the floor from the inner edge of the mid-point of the baseline is 1.575 m.",
  "The 2-point line is not part of the 2-point field goal area.",
  // No-charge semi-circle
  "The no-charge semi-circle has a radius of 1.25 m measured from the point on the floor beneath the exact centre of the basket to the inner edge of the semi-circle.",
  "The two short parallel lines of the no-charge semi-circle are 0.375 m in length and end 1.20 m from the inner edge of the baseline.",
  "The no-charge semi-circle line is part of the no-charge semi-circle area.",
  // Equipment
  "A backstop unit consists of backboard, basket comprising pressure release ring and net, and backboard support structure including padding.",
  "A game clock, scoreboard and shot clock are required.",
  "Two separate, distinctly different and loud signals are required, one for the shot clock operator and one for the scorer or timer.",
  "Adequate lighting and a playing floor are required.",
  // TEAMS — definition & rule
  "A team member is eligible to play when he has been authorised to play according to the regulations of the organising body of the competition.",
  "A team member is entitled to play when his name has been entered on the scoresheet before the beginning of the game and as long as he has not been disqualified.",
  "During playing time a team member on the court is a player and a team member off the court is a substitute.",
  "During an interval of play all team members entitled to play are considered as players.",
  "Each team shall consist of no more than 4 team members entitled to play, 3 players on the court and 1 substitute.",
  "Coaches on the playing court, on the seats for substitutes or remote coaching from outside the court are not allowed.",
  "A substitute becomes a player after his teammate steps off the court.",
  // Uniforms
  "The uniform of all team members shall consist of shirts and shorts of the same dominant colour front and back and socks of the same dominant colour for all team members.",
  "Each team member shall wear a shirt numbered on the front and back with plain numbers of a colour contrasting with the shirt.",
  "Numbers on the back shall be at least 15 cm high and numbers on the front at least 5 cm high.",
  "The numbers shall be at least 2 cm wide.",
  "Teams may only use numbers 0 and 00 and from 1 to 99.",
  "Players on the same team shall not wear the same number.",
  "Any advertising or logo shall be at least 5 cm away from the numbers.",
  "The first team named in the schedule shall wear light-coloured shirts and the second team shall wear dark-coloured shirts.",
  // Other equipment (selected)
  "All equipment used by players must be appropriate for the game and may not give an unfair advantage.",
  "Players shall not wear equipment or objects that may cause injury to other players.",
  "Hair accessories and jewellery are not permitted.",
  "Arm and leg compression sleeves are permitted.",
  "Headgear is permitted but shall not cover any part of the face and shall have no parts extruding from its surface.",
  "All players on a team must have sleeves, headgear, wristbands, headbands and tapings of black colour except for national team competitions with uniform colour rules.",
  // Players: injury (selected)
  "If the ball is live when an injury occurs a referee shall not blow his whistle until the team in control has shot, lost control, withheld the ball or the ball has become dead unless necessary to protect a player.",
  "If the injured player cannot continue to play immediately or receives treatment he must be substituted.",
  "During the game any player who is bleeding or has an open wound must be substituted.",
  // PLAYING REGULATIONS — time & overtime
  "The regular playing time shall be 1 period of 10 minutes.",
  "The game clock shall be stopped during dead ball situations and free throws.",
  "There shall be an interval of play of 1 minute between the regular playing time and overtime.",
  "If the score is tied at the end of regular playing time an overtime shall be played.",
  "The first team to score 2 points in the overtime wins the game.",
  // Beginning & end
  "A coin flip shall determine which team gets the first possession.",
  "The team that wins the coin flip can choose the first possession at the beginning of the game or at the beginning of a potential overtime.",
  "The regular playing time begins when the ball is in the hands of the offensive player after the check-ball has been completed.",
  "The regular playing time ends when the game clock signal sounds for the end of the regular playing time or a team reaches 21 or 22 points during regular playing time.",
  // Status of the ball (selected)
  "The ball can be either live or dead.",
  "Following each successful field goal or last free throw the ball becomes live.",
  "The ball becomes dead when a referee blows the whistle while the ball is live.",
  "The ball does not become dead and the goal counts if the ball is in flight on a shot when the whistle or a clock signal sounds.",
  // Location
  "The location of a player is determined by where he is touching the floor.",
  "While airborne a player retains the same status he had when he last touched the floor.",
  // Jump ball situation
  "A held ball occurs when opponents have one or both hands firmly on the ball so that neither can gain control without undue roughness.",
  "A live ball lodging between the ring and the backboard creates a jump ball situation except between free throws or after the last free throw followed by a check-ball.",
  "A jump ball situation shall be resumed with a check-ball for the last defensive team and the shot clock shall be reset to 12 seconds.",
  // How the ball is played
  "During the game the ball is played with the hand or hands only and may be passed, thrown, tapped, rolled or dribbled in any direction.",
  "A player shall not run with the ball, deliberately kick or block it with any part of the leg or strike it with the fist.",
  // Control of the ball
  "Team control starts when a player of that team is in control of a live ball by holding or dribbling it or has a live ball at his disposal.",
  "Team control ends when an opponent gains control, when the ball becomes dead or when the ball has left the player's hands on a shot or free throw.",
  // Player in the act of shooting (selected)
  "A shot for a goal is when the ball is held in a player's hands and then thrown into the air towards the basket.",
  "The act of shooting starts when the player starts the continuous movement normally preceding the release of the ball.",
  "The act of shooting ends when the ball has left the player's hands or in case of an airborne shooter when both feet have returned to the floor.",
  // Goal: when made & value (selected)
  "A goal is made when a live ball enters the basket from above and remains within or passes through the basket entirely.",
  "A goal released from inside the arc counts 1 point.",
  "A goal released from behind the arc counts 2 points.",
  "If a defensive player accidentally scores a field goal the goal shall count and shall be assigned to the last offensive player in ball control.",
  // Check-ball (selected)
  "Possession of the ball after any dead ball shall start with a check-ball behind the arc at the top of the playing court.",
  "The defensive player shall hand over or bounce the ball to the opponent to start the check-ball.",
  "At the beginning of the regular playing time or overtime the check-ball shall be administered by the referee.",
  // Time-out (selected)
  "Each team shall be granted 1 time-out.",
  "In FIBA 3x3 Official Competitions 2 TV time-outs are granted at the first dead ball after 6:59 and 3:59.",
  "All time-outs shall last 30 seconds.",
  // Substitution
  "Both teams may request a substitution when the ball becomes dead prior to a check-ball or free throw.",
  "Substitutions can only take place behind the endline and require no action from the referees or table officials.",
  // Game lost by forfeit/default (selected)
  "A team shall lose the game by forfeit if at the scheduled starting time the team is not present on the playing court with 3 players ready to play.",
  "In case of forfeit the game score is marked with w-0 or 0-w.",
  "A team shall lose a game by default if it leaves the court before the end of the game or all the players are injured and or disqualified.",
  // Violations — definitions (selected)
  "A violation is an infraction of the rules and the ball shall be awarded to the opponents for a check-ball.",
  "A player is out-of-bounds when any part of his body is in contact with the floor or any object outside the boundary line.",
  "A dribble is the movement of a live ball caused by a player who throws, taps, rolls or bounces the ball on the floor.",
  "A player shall not dribble for a second time after his first dribble has ended unless the ball has been touched or control lost as defined.",
  "Travelling is the illegal movement of one foot or both feet beyond the limits while holding a live ball on the playing court.",
  "A player shall not remain in the restricted area for more than 3 consecutive seconds while his team is in control of a live ball and the game clock is running.",
  "A closely guarded player must pass, shoot or dribble within 5 seconds.",
  "An offensive player shall not dribble inside the arc with his back or side to the basket for more than 3 consecutive seconds.",
  "A team must attempt a shot for a field goal within 12 seconds according to the shot clock rules.",
  // Clearing the ball (selected)
  "After a defensive rebound the ball must be returned behind the arc by passing or dribbling.",
  "If the ball leaves the player's hands before it has been cleared the basket shall be cancelled and the ball awarded to the opponents.",
  // Goaltending & Interference (selected)
  "Goaltending occurs when a player touches the ball while it is completely above the level of the ring and on its downward flight or after it has touched the backboard.",
  "Interference occurs when a player touches the basket or backboard while the ball is in contact with the ring.",
  "If a defensive player commits goaltending the offensive team is awarded 1 point for a free throw, 1 point for a shot from inside the arc or 2 points for a shot from behind the arc.",
  // FOULS — definitions and principles (selected)
  "A foul is an infraction concerning illegal personal contact and or unsportsmanlike behaviour.",
  "The cylinder principle is the space within an imaginary cylinder occupied by a player on the floor.",
  "Each player has the right to a vertical position within his cylinder.",
  "A defensive player has established an initial legal guarding position when he is facing his opponent with both feet on the floor.",
  "When guarding the player with the ball the elements of time and distance do not apply.",
  "Screening is an attempt to delay or prevent an opponent without the ball from reaching a desired position on the playing court.",
  "Charging is illegal personal contact by pushing or moving into an opponent's torso.",
  "Blocking is illegal personal contact which impedes the progress of an opponent with or without the ball.",
  "On any penetration into the no-charge semi-circle, contact by an airborne offensive player with a defensive player inside the semi-circle shall not be called as an offensive foul.",
  "Illegal guarding from the rear is personal contact from behind by a defensive player.",
  "Holding is illegal personal contact that interferes with an opponent's freedom of movement.",
  "Pushing is illegal personal contact where a player forcibly moves or attempts to move an opponent.",
  "Fake being fouled is any action to simulate being fouled or to exaggerate contact to gain an advantage.",
  // Contact foul & penalties (selected)
  "A contact foul is a player's illegal contact with an opponent whether the ball is live or dead.",
  "If a foul is committed on a player not in the act of shooting the game shall be resumed with a check-ball, or free throws as of the seventh team foul.",
  "If the shot released from behind the arc is unsuccessful the fouled player is awarded 2 free throws.",
  // Double foul, Technical, Unsportsmanlike, DQ (selected)
  "A double foul is when two opponents commit contact fouls on each other at approximately the same time.",
  "A technical foul is a non-contact foul of a behavioural nature including actions such as disrespectful communication or delaying the game.",
  "A technical foul counts as a team foul and the opponents are awarded 1 free throw.",
  "An unsportsmanlike foul is a contact foul with an excessive, hard or dangerous contact.",
  "A player shall be disqualified when he is charged with 2 unsportsmanlike fouls.",
  "A disqualifying foul is any flagrant unsportsmanlike action by players or substitutes.",
  // Team fouls penalty (selected)
  "A team is in the team foul penalty situation after it has committed 6 team fouls.",
  "Team fouls 7, 8 and 9 are penalized with 2 free throws.",
  "Team foul 10 and any subsequent team fouls are penalized with 2 free throws and ball possession.",
  // Free throws (selected)
  "A free throw is an opportunity to score 1 point uncontested from behind the free-throw line.",
  "The free-throw shooter must release the ball within 5 seconds after it is placed at his disposal by the referee.",
  "Players not in the free-throw rebound places shall remain behind the free-throw line extended and behind the arc until the free throw ends.",
  // Correctable errors (selected)
  "Referees may correct awarding of an unmerited free throw or failing to award a merited free throw if recognised before the ball becomes live following the first dead ball after the error.",
  "An error in scorekeeping, time-keeping or shot clock operations may be corrected by the referees at any time before the scoresheet is signed.",
  // OFFICIALS — duties (selected)
  "There shall be 2 referees assisted by the table officials and by a sports supervisor if present.",
  "The table officials shall be a scorer, a scoreboard operator and a shot clock operator.",
  "The referees shall administer a coin flip before the beginning of the game.",
  "The scoreboard operator shall measure playing time, time-outs and intervals of play.",
  "The shot clock operator shall start or restart the shot clock when a team gains control of a live ball on the playing court."
];

/* ============================================================
   Build text questions using exact sentences as correct answers
   Distractors are algorithmically perturbed variants.
   ============================================================ */
function tweakNumbers(s, delta=1){
  return s.replace(/(\d+)(\.\d+)?\s*(m|cm|minutes?|seconds?|free throws?|team fouls?|\b)/gi, (m,num,dec,unit)=>{
    const base = dec ? parseFloat(num+dec) : parseInt(num,10);
    let n = base;
    if (base===1) n=2; else if (base===2) n=1; else n = base+delta;
    const out = dec ? String(n) : String(n);
    return m.replace(String(base), out);
  });
}
function swapWords(s){
  // simple swaps: shall<->may, is<->is not, inside<->outside, offensive<->defensive
  let t=s;
  t=t.replace(/\bshall\b/g,'may')
     .replace(/\bis\b/g,'is not')
     .replace(/\binside\b/g,'outside')
     .replace(/\boutside\b/g,'inside')
     .replace(/\boffensive\b/g,'defensive')
     .replace(/\bdefensive\b/g,'offensive');
  return t;
}
function softParaphrase(s){
  return s.replace(/\bthe\b/gi,'the')
          .replace(/\bmay\b/gi,'shall')
          .replace(/\bare\b/gi,'are not');
}
function makeTextItem(sentence, idx){
  const correct = sentence.trim().replace(/\s+/g,' ').replace(/\s+\./g,'.');
  const d1 = tweakNumbers(correct,1);
  const d2 = swapWords(correct);
  const d3 = softParaphrase(correct);
  const pool = uniqBy([correct,d1,d2,d3], x=>x).slice(0,4);
  const options = shuffle(pool.length<4 ? [...pool, "(intentionally left blank)", "(not stated)", "(contradicts the rule)"].slice(0,4) : pool);
  return {
    id:`TXT::${idx}`, type:"text", cat:"Rule text",
    q:"Select the exact sentence from the official rules:",
    options, answer: options.indexOf(correct),
    rationale: `Correct (verbatim): “${correct}”.`
  };
}
const TEXT_QS = FACT_SENTENCES.map(makeTextItem);

/* ============================================================
   Assemble the full pool, shuffle order, no duplicates
   ============================================================ */
const POOL = shuffle(uniqBy([...TEXT_QS, ...buildSignalQuestions()], q=>q.id));
const TOTAL = POOL.length;
const RUN = { order: POOL, answers: Array(TOTAL).fill(null), i: 0, score: 0 };

/* ============================================================
   DOM bindings
   ============================================================ */
const $qtext = document.getElementById("qtext");
const $qimg  = document.getElementById("qimg");
const $opts  = document.getElementById("options");
const $next  = document.getElementById("next");
const $back  = document.getElementById("back");
const $submit= document.getElementById("submit");
const $qcount= document.getElementById("qcount");
const $cat   = document.getElementById("category");
const $prog  = document.getElementById("progress");
const $fb    = document.getElementById("feedback");

function render(i){
  const q = RUN.order[i];
  $qcount.textContent = `Question ${i+1} / ${TOTAL}`;
  $cat.textContent = q.cat || "General";
  $qtext.textContent = q.q;
  $fb.textContent = "";

  if(q.type==="image"){
    $qimg.src = q.img; $qimg.classList.remove("hidden"); $qimg.alt="Referee signal";
  } else { $qimg.classList.add("hidden"); }

  $opts.innerHTML = "";
  q.options.forEach((opt,idx)=>{
    const div = document.createElement("label");
    div.className = "opt";
    div.innerHTML = `<input type="radio" name="q${i}"> <span>${opt}</span>`;
    div.addEventListener("click",()=>{
      if(RUN.answers[i]!=null) return; // lock after first answer
      RUN.answers[i]=idx;
      [...$opts.children].forEach((c,j)=>{
        if(j===q.answer) c.classList.add("correct");
        if(j===idx && idx!==q.answer) c.classList.add("wrong");
      });
      if(idx===q.answer) RUN.score++;
      $fb.innerHTML = `<span class="${idx===q.answer?'good':'bad'}"><b>${idx===q.answer?'Correct':'Incorrect'}</b></span> — ${q.rationale||''}`;
    });
    $opts.appendChild(div);
  });

  $back.disabled = i===0;
  $next.classList.toggle("hidden", i===TOTAL-1);
  $submit.classList.toggle("hidden", i!==TOTAL-1);
  $prog.style.width = `${(i)/TOTAL*100}%`;
}

$next.addEventListener("click", ()=>{ RUN.i=Math.min(TOTAL-1,RUN.i+1); render(RUN.i); });
$back.addEventListener("click", ()=>{ RUN.i=Math.max(0,RUN.i-1); render(RUN.i); });
$submit.addEventListener("click", finish);

function finish(){
  const container = document.getElementById("quiz");
  const results = document.getElementById("results");
  let correct = 0;
  const keyEl = document.getElementById("answerKey");
  keyEl.innerHTML = "";

  RUN.order.forEach((q,idx)=>{
    const chosen = RUN.answers[idx];
    if(chosen===q.answer) correct++;

    const row = document.createElement("div");
    row.className = "answer-row";
    const left = document.createElement("div");
    if(q.type==="image"){
      const img = document.createElement("img");
      img.src = q.img; img.alt="Referee signal";
      left.appendChild(img);
    }else{
      left.innerHTML = `<div class="pill">${q.cat||"General"}</div>`;
    }
    const right = document.createElement("div");
    right.innerHTML = `
      <div><strong>Q${idx+1}.</strong> ${q.q}</div>
      <div><span class="good"><b>Correct answer:</b></span> ${q.options[q.answer]}</div>
      <div><span class="${chosen===q.answer?'good':'bad'}"><b>Your answer:</b></span> ${chosen!=null ? q.options[chosen] : "(no answer)"} </div>
    `;
    row.appendChild(left); row.appendChild(right);
    keyEl.appendChild(row);
  });

  document.getElementById("scoreline").textContent = `Score: ${correct} / ${TOTAL}`;
  container.classList.add("hidden");
  results.classList.remove("hidden");
  document.getElementById("progress").style.width="100%";
}

// Start
render(0);
</script>
</body>
</html>