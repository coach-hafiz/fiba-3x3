<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>FIBA Ref Signals ‚Äî Training Quiz</title>
  <style>
    :root{--bg:#0f1115;--card:#171a21;--muted:#8a93a6;--text:#e8ecf3;--accent:#ff7a00;--ok:#1db954;--bad:#ff4d4f}
    *{box-sizing:border-box;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#0e1014,#0b0d11);color:var(--text);min-height:100vh}
    .wrap{max-width:900px;margin:0 auto;padding:24px}
    .header{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:20px}
    .brand{display:flex;align-items:center;gap:12px}
    .brand .dot{width:12px;height:12px;background:var(--accent);border-radius:50%}
    .card{background:var(--card);border:1px solid #212632;border-radius:18px;padding:22px;box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .qtext{font-size:1.2rem;line-height:1.45;margin:6px 0 14px}
    .imgbox{display:flex;justify-content:center;margin:10px 0 14px}
    .imgbox img{max-width:100%;height:auto;border-radius:12px;border:1px solid #2a3040}
    .answers{display:grid;gap:10px;margin-top:6px}
    .ans{padding:14px 16px;border:1px solid #2a3040;border-radius:12px;background:#12161e;cursor:pointer;transition:.15s}
    .ans:hover{border-color:#3a4256;transform:translateY(-1px)}
    .ans[disabled]{opacity:.85;cursor:not-allowed}
    .ans.correct{border-color:var(--ok);background:#0f1a13}
    .ans.wrong{border-color:var(--bad);background:#1a0f10}
    .meta{display:flex;justify-content:space-between;gap:10px;color:var(--muted);font-size:.95rem;margin:10px 0 4px}
    .expl{margin-top:10px;padding:12px 14px;border-radius:12px;background:#12161e;border:1px dashed #2a3040}
    .controls{display:flex;justify-content:space-between;align-items:center;margin-top:16px;gap:10px}
    button{border:none;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
    .next{background:var(--accent);color:#111}
    .next[disabled]{opacity:.5;cursor:not-allowed}
    .ghost{background:transparent;color:var(--muted);border:1px solid #2a3040}
    .pill{padding:6px 10px;border-radius:999px;border:1px solid #2a3040;color:var(--muted);font-size:.85rem}
    .footer{margin-top:18px;color:var(--muted);font-size:.85rem;text-align:center}
    /* Summary */
    .summary h2{margin:0 0 10px}
    .list{display:grid;gap:14px;margin-top:16px}
    .mini{border:1px solid #2a3040;border-radius:14px;padding:14px;background:#12161e}
    .mini h4{margin:0 0 6px;font-size:1rem}
    .tag{font-size:.8rem;color:#b0bad0;margin-left:6px}
    .badtxt{color:var(--bad)}
    .oktxt{color:var(--ok)}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div class="brand">
        <div class="dot"></div>
        <div>
          <div style="font-weight:800;letter-spacing:.2px">FIBA Ref Signals ‚Äî Training</div>
          <div style="color:#9aa4b6;font-size:.9rem">Immediate feedback ‚Ä¢ One question per page ‚Ä¢ Offline bank</div>
        </div>
      </div>
      <div class="pill" id="progressPill">Q 1 / 1</div>
    </div>

    <div class="card" id="stage"><!-- question or summary renders here --></div>
    <div class="footer">Tip: Use ‚ÄúRetry wrong only‚Äù at the end to focus practice.</div>
  </div>

<script>
/* =======================
   QUESTION BANK (edit me)
   ======================= */
/*
Each question:
{
  id: "img-11",
  tier: "T1" | "T2",
  category: "Signals",
  prompt: "What does this signal indicate?",
  imageSrc: "images/11.Out-of-bounds.jpg", // optional
  choices: ["Out-of-bounds", "Held ball / jump ball", "Travelling", "Visible count"],
  correctIndex: 0,
  explanation: "Pointing with fingers together along the boundary = out-of-bounds direction."
}
*/
const QUESTIONS = [
  // --- SAMPLE ITEMS (replace/extend with your full bank) ---
  {
    id: "img-11", tier: "T1", category: "Signals",
    prompt: "What does this referee signal indicate?",
    imageSrc: "images/11.out-of-bounds.jpg",
    choices: ["Out-of-bounds (direction)", "Held ball / jump ball situation", "Charging with the ball", "Technical foul"],
    correctIndex: 0,
    explanation: "Extended arm with fingers together pointing the direction = out-of-bounds / team direction."
  },
  {
    id: "img-12", tier: "T1", category: "Signals",
    prompt: "Name this signal.",
    imageSrc: "images/12.held-ball.jpg",
    choices: ["Double foul", "Held ball / jump ball", "Blocking", "5 seconds"],
    correctIndex: 1,
    explanation: "Two thumbs up, arms extended: held ball (jump ball)."
  },
  {
    id: "txt-2pt", tier: "T2", category: "Scoring",
    prompt: "A basket is made while the official shows the signal in image #4 (two raised fingers). How many points count?",
    choices: ["1", "2", "3", "It depends on foul/bonus"],
    correctIndex: 1,
    explanation: "Two fingers indicates a 2-point goal."
  },
  {
    id: "img-45", tier: "T1", category: "Fouls",
    prompt: "Identify the foul being signaled.",
    imageSrc: "images/45.technical-foul.jpg",
    choices: ["Unsportsmanlike", "Technical", "Disqualifying", "Blocking"],
    correctIndex: 1,
    explanation: "‚ÄòT‚Äô sign with one hand vertical and the other horizontal = technical foul."
  },
  // Add your remaining items here ‚Äî include *all* images & text rules.
];

/* ===========
   QUIZ STATE
   =========== */
let idx = 0;
let score = 0;
let answered = new Map(); // id -> {choice, correct}
let wrongIds = new Set();

const stage = document.getElementById('stage');
const pill  = document.getElementById('progressPill');

function fmtProgress() {
  pill.textContent = `Q ${Math.min(idx+1, QUESTIONS.length)} / ${QUESTIONS.length}`;
}

function renderQuestion(q) {
  fmtProgress();
  stage.innerHTML = '';
  const meta = el('div','meta');
  meta.innerHTML = `
    <span>Category: <strong>${q.category}</strong> <span class="tag">‚Ä¢ ${q.tier}</span></span>
    <span>Score: <strong>${score}</strong></span>`;
  stage.appendChild(meta);

  const qtext = el('div','qtext', q.prompt);
  stage.appendChild(qtext);

  if (q.imageSrc) {
    const imgBox = el('div','imgbox');
    const img = new Image();
    img.alt = 'question image';
    img.src = q.imageSrc;
    imgBox.appendChild(img);
    stage.appendChild(imgBox);
  }

  const answers = el('div','answers');
  q.choices.forEach((choice, i) => {
    const b = el('button','ans', choice);
    b.addEventListener('click', () => selectAnswer(q, i, b, answers));
    answers.appendChild(b);
  });
  stage.appendChild(answers);

  const expl = el('div','expl'); expl.style.display='none'; stage.appendChild(expl);

  const controls = el('div','controls');
  const back = btn('Back', 'ghost', () => {
    if (idx>0){ idx--; renderQuestion(QUESTIONS[idx]); }
  });
  const next = btn('Next', 'next', () => {
    if (idx < QUESTIONS.length-1) { idx++; renderQuestion(QUESTIONS[idx]); }
    else renderSummary();
  });
  next.disabled = !answered.has(q.id);
  controls.append(back, next);
  stage.appendChild(controls);

  // If already answered (navigated back), show feedback instantly
  if (answered.has(q.id)) {
    const {choice, correct} = answered.get(q.id);
    lockAnswers(answers, choice, q.correctIndex);
    showExpl(expl, correct, q);
  }

  // helpers bound to question scope
  function selectAnswer(q, choiceIdx, btnEl, answersWrap){
    if (answered.has(q.id)) return; // already graded
    const correct = choiceIdx === q.correctIndex;
    answered.set(q.id, {choice: choiceIdx, correct});
    if (!correct) wrongIds.add(q.id); else { wrongIds.delete(q.id); score++; }
    lockAnswers(answersWrap, choiceIdx, q.correctIndex);
    showExpl(expl, correct, q);
    // enable Next
    stage.querySelector('.next').disabled = false;
    // update header score (training shows live)
    stage.querySelector('.meta span:last-child strong').textContent = score;
  }
}

function lockAnswers(container, chosen, correct){
  [...container.children].forEach((b, i)=>{
    b.disabled = true;
    if (i===correct) b.classList.add('correct');
    if (i===chosen && i!==correct) b.classList.add('wrong');
  });
}
function showExpl(node, correct, q){
  node.style.display='block';
  node.innerHTML = `
    <div><strong>${correct ? 'Correct ‚úÖ' : 'Not quite ‚ùå'}</strong></div>
    <div style="margin-top:6px">${q.explanation || ''}</div>`;
}

/* =========
   SUMMARY
   ========= */
function renderSummary() {
  pill.textContent = 'Summary';
  stage.innerHTML = '';
  const wrap = el('div','summary');
  wrap.innerHTML = `
    <h2>Training Summary</h2>
    <div class="meta"><span>Total questions: <strong>${QUESTIONS.length}</strong></span>
      <span>Score: <strong class="${score===QUESTIONS.length?'oktxt':'badtxt'}">${score}</strong> / ${QUESTIONS.length} (${Math.round(100*score/QUESTIONS.length)}%)</span>
    </div>`;
  stage.appendChild(wrap);

  if (wrongIds.size>0){
    const list = el('div','list');
    wrap.appendChild(el('div',null,'Review these:'));
    [...wrongIds].forEach(id=>{
      const q = QUESTIONS.find(x=>x.id===id);
      const you = answered.get(id)?.choice;
      const mini = el('div','mini');
      mini.innerHTML = `
        <h4>${q.prompt}</h4>
        ${q.imageSrc ? `<div class="imgbox" style="margin:6px 0 10px"><img src="${q.imageSrc}" alt=""></div>`:''}
        <div>Correct: <strong>${q.choices[q.correctIndex]}</strong></div>
        <div>Your answer: <span class="badtxt">${q.choices[you]}</span></div>
        <div class="expl" style="margin-top:10px">${q.explanation||''}</div>`;
      list.appendChild(mini);
    });
    wrap.appendChild(list);
  } else {
    wrap.appendChild(el('div',null,'Perfect score! üéâ'));
  }

  const controls = el('div','controls');
  controls.append(
    btn('Retry wrong only', 'ghost', () => {
      if (wrongIds.size===0){ idx=0; resetAll(); renderQuestion(QUESTIONS[0]); return; }
      const filtered = QUESTIONS.filter(q=>wrongIds.has(q.id));
      launchSubset(filtered);
    }),
    btn('Restart full quiz', 'next', () => { idx=0; resetAll(); renderQuestion(QUESTIONS[0]); })
  );
  stage.appendChild(controls);
}

function launchSubset(subset){
  // Temporarily swap in subset
  window._fullBank = window._fullBank || QUESTIONS.slice();
  const custom = subset.slice();
  QUESTIONS.length = 0; custom.forEach(q=>QUESTIONS.push(q));
  idx=0; resetAll(); renderQuestion(QUESTIONS[0]);
  // Add a small banner to restore full bank when done
  const banner = document.createElement('div');
  banner.className = 'pill'; banner.style.margin='12px 0 0';
  banner.textContent = `Practicing ${custom.length} missed questions ‚Äî click to return to full bank`;
  banner.style.cursor='pointer';
  banner.onclick = () => {
    const full = window._fullBank.slice(); QUESTIONS.length=0; full.forEach(q=>QUESTIONS.push(q));
    window._fullBank=null; idx=0; resetAll(); renderQuestion(QUESTIONS[0]);
  };
  stage.parentElement.insertBefore(banner, stage.nextSibling);
}

function resetAll(){
  score = 0; answered.clear(); wrongIds.clear(); fmtProgress();
  // remove any practice banner
  const sib = stage.nextSibling; if (sib && sib.classList?.contains('pill')) sib.remove();
}

/* ========
   HELPERS
   ======== */
function el(tag, cls, text){ const n=document.createElement(tag); if(cls) n.className=cls; if(text) n.textContent=text; return n; }
function btn(label, cls, on){ const b=document.createElement('button'); b.textContent=label; b.className=cls==='next'?'next':(cls||''); b.onclick=on; return b; }

/* Kickoff */
if (QUESTIONS.length === 0) {
  stage.innerHTML = '<div class="qtext">No questions loaded yet. Add items to the QUESTIONS array.</div>';
  pill.textContent = 'Empty bank';
} else {
  renderQuestion(QUESTIONS[0]);
}
</script>
</body>
</html>